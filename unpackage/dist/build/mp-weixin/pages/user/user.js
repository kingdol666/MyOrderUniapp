"use strict";const e=require("../../common/vendor.js"),o=require("../../api/index.js"),n=require("../../store/index.js"),i={setup(){const i=e.ref(!1),t=e.reactive({id:"",openId:"",nickname:"",avatarUrl:"",gender:0}),s=e.ref([{label:"全部订单",count:0,status:"all"},{label:"待付款",count:0,status:"pending"},{label:"进行中",count:0,status:"processing"},{label:"已完成",count:0,status:"completed"}]),r=e.ref([{id:1,name:"我的订单",icon:"list",color:"#007AFF",path:"/pages/order/list"},{id:2,name:"优惠券",icon:"ticket",color:"#51cf66",badge:"2",badgeType:"error",path:"/pages/coupon/list"},{id:3,name:"联系客服",icon:"headphones",color:"#fcc419",path:"/pages/service/contact"},{id:4,name:"设置",icon:"gear",color:"#666",path:"/pages/settings/index"}]),a=e.ref(null);return{isLoggedIn:i,userInfo:t,orderStats:s,menuItems:r,handleLogout:()=>{a.value.open()},goToSettings:()=>{e.index.navigateTo({url:"/pages/settings/index"})},goToOrders:o=>{i.value?e.index.navigateTo({url:`/pages/order/list?status=${o}`}):e.index.showModal({title:"提示",content:"请先登录",confirmText:"去登录",success:e=>{e.confirm&&handleLogin()}})},handleMenuClick:o=>{i.value?e.index.navigateTo({url:o.path}):e.index.showModal({title:"提示",content:"请先登录",confirmText:"去登录",success:e=>{e.confirm&&handleLogin()}})},onGetUserInfo:async s=>{try{if("getUserInfo:ok"!==s.detail.errMsg)throw new Error("用户拒绝授权");const r=await new Promise(((o,n)=>{e.index.login({provider:"weixin",success:e=>o(e),fail:e=>n(e)})})),a=await o.userApi.wxLogin({code:r.code,userInfo:s.detail.userInfo});Object.assign(t,{...a.user,nickName:s.detail.userInfo.nickName,avatarUrl:s.detail.userInfo.avatarUrl,gender:s.detail.userInfo.gender}),n.store.login(t,a.token),i.value=!0,e.index.showToast({title:"登录成功",icon:"success"}),console.log(a),console.log(t)}catch(r){console.error("登录失败:",r),"用户拒绝授权"===r.message?e.index.showModal({title:"提示",content:"需要您的授权才能继续使用",showCancel:!1}):e.index.showToast({title:r.message||"登录失败",icon:"none"})}},logoutPopupRef:a,confirmLogout:()=>{n.store.logout(),i.value=!1,e.index.showToast({title:"已退出登录",icon:"success"}),a.value.close()},closeLogout:()=>{a.value.close()}}},onShow(){}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-card")+e.resolveComponent("uni-grid-item")+e.resolveComponent("uni-grid")+e.resolveComponent("uni-section")+e.resolveComponent("uni-badge")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../uni_modules/uni-grid/components/uni-grid-item/uni-grid-item.js")+(()=>"../../uni_modules/uni-grid/components/uni-grid/uni-grid.js")+(()=>"../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../uni_modules/uni-badge/components/uni-badge/uni-badge.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t=e._export_sfc(i,[["render",function(o,n,i,t,s,r){return e.e({a:!t.isLoggedIn},t.isLoggedIn?{e:t.userInfo.avatarUrl,f:e.t(t.userInfo.nickname),g:e.t(t.userInfo.id)}:{b:e.p({type:"person",size:"50",color:"#999"}),c:e.o(((...e)=>o.handleLogin&&o.handleLogin(...e))),d:e.o(((...e)=>t.onGetUserInfo&&t.onGetUserInfo(...e)))},{h:e.o(t.goToSettings),i:e.p({type:"gear",size:"24",color:"#666"}),j:e.f(t.orderStats,((o,n,i)=>({a:e.t(o.count),b:e.t(o.label),c:n,d:e.o((e=>t.goToOrders(o.status)),n),e:"30edea30-5-"+i+",30edea30-4"}))),k:e.p({column:4,highlight:!1,showBorder:!1}),l:e.p({title:"我的订单",type:"line"}),m:e.f(t.menuItems,((o,n,i)=>e.e({a:"30edea30-7-"+i+",30edea30-6",b:e.p({"custom-prefix":"custom-icon",type:o.icon,size:"28",color:o.color}),c:e.t(o.name),d:o.badge},o.badge?{e:"30edea30-8-"+i+",30edea30-6",f:e.p({text:o.badge,type:o.badgeType||"error",absolute:"rightTop"})}:{},{g:o.id,h:e.o((e=>t.handleMenuClick(o)),o.id)}))),n:e.p({title:"我的服务",type:"line"}),o:e.o(t.confirmLogout),p:e.o(t.closeLogout),q:e.p({type:"warning",title:"提示",content:"确定要退出登录吗？",duration:2e3,"before-close":!0}),r:e.sr("logoutPopupRef","30edea30-9"),s:e.p({type:"dialog"}),t:t.isLoggedIn},t.isLoggedIn?{v:e.p({type:"poweroff",size:"16",color:"#ff5a5f"}),w:e.o(((...e)=>t.handleLogout&&t.handleLogout(...e)))}:{})}],["__scopeId","data-v-30edea30"]]);wx.createPage(t);
