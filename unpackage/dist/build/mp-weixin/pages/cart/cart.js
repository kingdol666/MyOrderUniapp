"use strict";const t=require("../../common/vendor.js"),e=require("../../api/index.js"),a=require("../../store/index.js"),s={data:()=>({cartItems:[],userId:""}),computed:{totalAmount(){return this.cartItems.reduce(((t,e)=>t+e.itemPrice*e.quantity),0).toFixed(2)}},onShow(){this.userId=a.store.getUserId(),this.userId?(this.loadCartItems(),a.store.updateCartBadge()):t.index.showModal({title:"提示",content:"请先登录后再查看购物车",showCancel:!1,success:()=>{t.index.switchTab({url:"/pages/menu/menu"})}})},methods:{async loadCartItems(){try{this.cartItems=await e.cartApi.getCartItems(this.userId),console.log(this.cartItems),console.log("购物车数据:",this.cartItems)}catch(a){console.error("加载购物车失败:",a),t.index.showToast({title:"加载购物车失败",icon:"none"})}},async decreaseQuantity(s){if(!(s.quantity<=1))try{await e.cartApi.saveCartItem({userId:this.userId,menuItemId:s.menuItemId,quantity:-1}),await this.loadCartItems(),await a.store.updateCartBadge()}catch(o){console.error("减少数量失败:",o),t.index.showToast({title:"操作失败",icon:"none"})}},async increaseQuantity(s){try{await e.cartApi.saveCartItem({userId:this.userId,menuItemId:s.menuItemId,quantity:1}),await this.loadCartItems(),await a.store.updateCartBadge()}catch(o){console.error("增加数量失败:",o),t.index.showToast({title:"操作失败",icon:"none"})}},async removeItem(s){try{await e.cartApi.removeCartItem(this.userId,s.menuItemId),await this.loadCartItems(),await a.store.updateCartBadge(),t.index.showToast({title:"删除成功",icon:"success"})}catch(o){console.error("删除失败:",o),t.index.showToast({title:"删除失败",icon:"none"})}},navigateToMenu(){t.index.switchTab({url:"/pages/menu/menu"})},async checkout(){if(0!==this.cartItems.length)try{const a=await e.orderApi.createOrder(this.userId);console.log(a),t.index.navigateTo({url:`/pages/checkout/checkout?orderId=${a.id}`})}catch(a){console.error("创建订单失败:",a),t.index.showToast({title:"创建订单失败",icon:"none"})}}}};if(!Array){t.resolveComponent("uni-icons")()}Math;const o=t._export_sfc(s,[["render",function(e,a,s,o,r,i){return t.e({a:0===r.cartItems.length},0===r.cartItems.length?{b:t.p({type:"cart",size:"64",color:"#999"}),c:t.o(((...t)=>i.navigateToMenu&&i.navigateToMenu(...t)))}:{d:t.f(r.cartItems,((e,a,s)=>({a:e.itemImageUrl,b:t.t(e.itemName),c:t.t(e.itemPrice),d:t.o((t=>i.decreaseQuantity(e)),e.id),e:"0940fa6a-1-"+s,f:t.p({type:"minus",size:"20",color:e.quantity<=1?"#ccc":"#007AFF"}),g:t.t(e.quantity),h:t.o((t=>i.increaseQuantity(e)),e.id),i:"0940fa6a-2-"+s,j:t.o((t=>i.removeItem(e)),e.id),k:"0940fa6a-3-"+s,l:e.id}))),e:t.p({type:"plus",size:"20",color:"#007AFF"}),f:t.p({type:"trash",size:"24",color:"#ff5a5f"}),g:t.t(i.totalAmount),h:0===r.cartItems.length,i:t.o(((...t)=>i.checkout&&i.checkout(...t)))})}],["__scopeId","data-v-0940fa6a"]]);wx.createPage(o);
