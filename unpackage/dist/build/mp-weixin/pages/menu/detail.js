"use strict";const e=require("../../common/vendor.js"),t=require("../../api/index.js"),o=require("../../store/index.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const n={__name:"detail",setup(n){const a=e.ref({}),s=e.ref(1),i=e.ref(""),r=e.ref([]),u=e.computed((()=>!!i.value)),l=async()=>{try{const n=o.store.getUserId();if(!n)return void e.index.showModal({title:"提示",content:"请先登录后再操作",confirmText:"去登录",success:t=>{t.confirm&&e.index.switchTab({url:"/pages/user/user"})}});await t.cartApi.saveCartItem({userId:n,menuItemId:a.value.id,quantity:s.value}),e.index.showToast({title:"已加入购物车",icon:"success"})}catch(n){console.error("添加到购物车失败:",n),e.index.showToast({title:"添加失败",icon:"none"})}},c=()=>{s.value++},d=()=>{s.value>1&&s.value--};return e.onMounted((()=>{var o;const n=getCurrentPages(),s=n[n.length-1],u=(null==(o=s.$page)?void 0:o.options)||s.options||{};console.log("页面参数:",u);const{id:l,keyword:c}=u;l?(async o=>{try{if(!o)return;console.log("加载菜品详情, id:",o);const e=await t.menuApi.getMenuItem(o);a.value=e}catch(n){console.error("获取菜品详情失败:",n),e.index.showToast({title:"获取菜品详情失败",icon:"none"})}})(l):c&&(i.value=decodeURIComponent(c),(async()=>{try{if(!i.value)return;console.log("搜索关键词:",i.value);const e=await t.menuApi.searchMenuItems(i.value);r.value=e||[]}catch(o){console.error("搜索失败:",o),e.index.showToast({title:"搜索失败",icon:"none"}),r.value=[]}})())})),(t,o)=>e.e({a:u.value},u.value?{b:e.t(i.value),c:e.t(r.value.length),d:e.f(r.value,((t,o,n)=>({a:t.imageUrl,b:e.t(t.name),c:e.t(t.description),d:e.t(t.price),e:e.t(t.salesCount),f:t.id,g:e.o((o=>{return n=t.id,void e.index.redirectTo({url:`/pages/menu/detail?id=${n}`});var n}),t.id)})))}:e.e({e:a.value.imageUrl,f:e.t(a.value.name),g:e.t(a.value.price),h:e.t(a.value.salesCount),i:a.value.isRecommend},(a.value.isRecommend,{}),{j:e.t(a.value.description),k:e.o(d),l:s.value<=1?1:"",m:e.p({type:"minus",size:"20",color:"#999"}),n:e.t(s.value),o:e.o(c),p:e.p({type:"plus",size:"20",color:"#007AFF"}),q:e.o(l)}))}},a=e._export_sfc(n,[["__scopeId","data-v-620aadc0"]]);wx.createPage(a);
