{"version":3,"names":["menuItem","common_vendor","ref","quantity","keyword","searchResults","isSearchMode","computed","value","loadMenuItemDetail","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","id","res","wrap","_callee$","_context","prev","next","index","__f__","api_index","menuApi","getMenuItem","sent","data","t0","showToast","title","icon","stop","_x","apply","arguments","increaseQuantity","decreaseQuantity","handleAddToCart","_ref2","_callee2","userId","_callee2$","_context2","store_index","store","getUserId","showModal","content","confirmText","success","confirm","switchTab","url","abrupt","cartApi","saveCartItem","menuItemId","searchMenuItems","_ref3","_callee3","_callee3$","_context3","showDetail","redirectTo","concat","onMounted","pages","getCurrentPages","currentPage","length","_currentPage$options","options","searchKeyword","decodeURIComponent","wx","createPage","MiniProgramPage"],"sources":["detail.vue","cGFnZXMvbWVudS9kZXRhaWwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"detail-container\">\r\n    <!-- 如果是搜索模式，显示搜索结果列表 -->\r\n    <template v-if=\"isSearchMode\">\r\n      <view class=\"search-result\">\r\n        <view class=\"result-header\">\r\n          <text class=\"result-title\">搜索\"{{ keyword }}\"</text>\r\n          <text class=\"result-count\">找到 {{ searchResults.length }} 个结果</text>\r\n        </view>\r\n        \r\n        <view class=\"result-list\">\r\n          <view \r\n            class=\"result-item\"\r\n            v-for=\"item in searchResults\" \r\n            :key=\"item.id\"\r\n            @tap=\"showDetail(item.id)\"\r\n          >\r\n            <image :src=\"item.imageUrl\" mode=\"aspectFill\" class=\"item-image\"/>\r\n            <view class=\"item-info\">\r\n              <text class=\"item-name\">{{ item.name }}</text>\r\n              <text class=\"item-desc\">{{ item.description }}</text>\r\n              <view class=\"item-bottom\">\r\n                <text class=\"item-price\">¥{{ item.price }}</text>\r\n                <text class=\"sales-count\">月售 {{ item.salesCount }}</text>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </template>\r\n    \r\n    <!-- 如果是详情模式，显示原有的详情内容 -->\r\n    <template v-else>\r\n      <!-- 菜品图片 -->\r\n      <image \r\n        :src=\"menuItem.imageUrl\" \r\n        mode=\"aspectFill\" \r\n        class=\"food-image\"\r\n      />\r\n      \r\n      <!-- 菜品信息 -->\r\n      <view class=\"food-info\">\r\n        <view class=\"basic-info\">\r\n          <text class=\"food-name\">{{ menuItem.name }}</text>\r\n          <text class=\"food-price\">¥{{ menuItem.price }}</text>\r\n        </view>\r\n        \r\n        <view class=\"sales-info\">\r\n          <text class=\"sales-count\">月售 {{ menuItem.salesCount }}</text>\r\n          <text class=\"recommend-tag\" v-if=\"menuItem.isRecommend\">店长推荐</text>\r\n        </view>\r\n        \r\n        <view class=\"description\">\r\n          <text class=\"desc-title\">菜品描述</text>\r\n          <text class=\"desc-content\">{{ menuItem.description }}</text>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 底部操作栏 -->\r\n      <view class=\"bottom-bar\">\r\n        <view class=\"quantity-control\">\r\n          <uni-icons \r\n            type=\"minus\" \r\n            size=\"20\" \r\n            color=\"#999\"\r\n            @click=\"decreaseQuantity\"\r\n            :class=\"{ disabled: quantity <= 1 }\"\r\n          />\r\n          <text class=\"quantity\">{{ quantity }}</text>\r\n          <uni-icons \r\n            type=\"plus\" \r\n            size=\"20\" \r\n            color=\"#007AFF\"\r\n            @click=\"increaseQuantity\"\r\n          />\r\n        </view>\r\n        \r\n        <button \r\n          class=\"add-to-cart\"\r\n          @tap=\"handleAddToCart\"\r\n        >\r\n          加入购物车\r\n        </button>\r\n      </view>\r\n    </template>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue'\r\nimport { menuApi, cartApi } from '@/api'\r\nimport store from '@/store'\r\n\r\nconst menuItem = ref({})\r\nconst quantity = ref(1)\r\nconst keyword = ref('')\r\nconst searchResults = ref([])\r\n\r\n// 是否为搜索模式\r\nconst isSearchMode = computed(() => !!keyword.value)\r\n\r\n// 获取菜品详情\r\nconst loadMenuItemDetail = async (id) => {\r\n  try {\r\n    console.log(id)\r\n    const res = await menuApi.getMenuItem(id)\r\n    console.log(res)\r\n    menuItem.value = res.data\r\n  } catch (error) {\r\n    console.error('获取菜品详情失败:', error)\r\n    uni.showToast({\r\n      title: '获取菜品详情失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n// 增加数量\r\nconst increaseQuantity = () => {\r\n  quantity.value++\r\n}\r\n\r\n// 减少数量\r\nconst decreaseQuantity = () => {\r\n  if (quantity.value > 1) {\r\n    quantity.value--\r\n  }\r\n}\r\n\r\n// 加入购物车\r\nconst handleAddToCart = async () => {\r\n  try {\r\n    const userId = store.getUserId()\r\n    if (!userId) {\r\n      uni.showModal({\r\n        title: '提示',\r\n        content: '请先登录后再操作',\r\n        confirmText: '去登录',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            uni.switchTab({ url: '/pages/user/user' })\r\n          }\r\n        }\r\n      })\r\n      return\r\n    }\r\n\r\n    await cartApi.saveCartItem({\r\n      userId: userId,\r\n      menuItemId: menuItem.value.id,\r\n      quantity: quantity.value\r\n    })\r\n    \r\n    uni.showToast({\r\n      title: '已加入购物车',\r\n      icon: 'success'\r\n    })\r\n  } catch (error) {\r\n    console.error('添加失败:', error)\r\n    uni.showToast({\r\n      title: '添加失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n// 搜索菜品\r\nconst searchMenuItems = async () => {\r\n  try {\r\n    console.log('搜索关键词:', keyword.value)\r\n    const res = await menuApi.searchMenuItems({\r\n      keyword: keyword.value  // 包装成对象传递\r\n    })\r\n    searchResults.value = res.data || []\r\n  } catch (error) {\r\n    console.error('搜索失败:', error)\r\n    uni.showToast({\r\n      title: '搜索失败',\r\n      icon: 'none'\r\n    })\r\n    searchResults.value = []\r\n  }\r\n}\r\n\r\n// 显示菜品详情\r\nconst showDetail = (id) => {\r\n  uni.redirectTo({\r\n    url: `/pages/menu/detail?id=${id}`\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  const pages = getCurrentPages()\r\n  const currentPage = pages[pages.length - 1]\r\n  const { id, keyword: searchKeyword } = currentPage.options\r\n  \r\n  if (id) {\r\n    loadMenuItemDetail(id)\r\n  } else if (searchKeyword) {\r\n    keyword.value = decodeURIComponent(searchKeyword)\r\n    searchMenuItems()\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.detail-container {\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n  \r\n  .search-result {\r\n    padding: 30rpx;\r\n    \r\n    .result-header {\r\n      margin-bottom: 30rpx;\r\n      \r\n      .result-title {\r\n        font-size: 32rpx;\r\n        font-weight: bold;\r\n        color: #333;\r\n        display: block;\r\n      }\r\n      \r\n      .result-count {\r\n        font-size: 24rpx;\r\n        color: #999;\r\n        margin-top: 8rpx;\r\n        display: block;\r\n      }\r\n    }\r\n    \r\n    .result-list {\r\n      .result-item {\r\n        display: flex;\r\n        background: #fff;\r\n        padding: 20rpx;\r\n        border-radius: 16rpx;\r\n        margin-bottom: 20rpx;\r\n        \r\n        .item-image {\r\n          width: 160rpx;\r\n          height: 160rpx;\r\n          border-radius: 12rpx;\r\n          margin-right: 20rpx;\r\n        }\r\n        \r\n        .item-info {\r\n          flex: 1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          \r\n          .item-name {\r\n            font-size: 30rpx;\r\n            font-weight: 500;\r\n            color: #333;\r\n          }\r\n          \r\n          .item-desc {\r\n            font-size: 26rpx;\r\n            color: #999;\r\n            margin: 12rpx 0;\r\n            display: -webkit-box;\r\n            -webkit-box-orient: vertical;\r\n            -webkit-line-clamp: 2;\r\n            overflow: hidden;\r\n          }\r\n          \r\n          .item-bottom {\r\n            margin-top: auto;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            \r\n            .item-price {\r\n              font-size: 32rpx;\r\n              color: #ff5a5f;\r\n              font-weight: bold;\r\n            }\r\n            \r\n            .sales-count {\r\n              font-size: 24rpx;\r\n              color: #999;\r\n            }\r\n          }\r\n        }\r\n        \r\n        &:active {\r\n          transform: scale(0.98);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  .food-image {\r\n    width: 100%;\r\n    height: 500rpx;\r\n  }\r\n  \r\n  .food-info {\r\n    margin-top: -40rpx;\r\n    padding: 40rpx 30rpx;\r\n    background: #fff;\r\n    border-radius: 40rpx 40rpx 0 0;\r\n    position: relative;\r\n    \r\n    .basic-info {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 20rpx;\r\n      \r\n      .food-name {\r\n        font-size: 36rpx;\r\n        font-weight: bold;\r\n        color: #333;\r\n      }\r\n      \r\n      .food-price {\r\n        font-size: 36rpx;\r\n        color: #ff5a5f;\r\n        font-weight: bold;\r\n      }\r\n    }\r\n    \r\n    .sales-info {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 20rpx;\r\n      margin-bottom: 30rpx;\r\n      \r\n      .sales-count {\r\n        font-size: 24rpx;\r\n        color: #999;\r\n      }\r\n      \r\n      .recommend-tag {\r\n        padding: 4rpx 16rpx;\r\n        background: #fff5e6;\r\n        color: #ff9500;\r\n        font-size: 24rpx;\r\n        border-radius: 100rpx;\r\n      }\r\n    }\r\n    \r\n    .description {\r\n      .desc-title {\r\n        font-size: 30rpx;\r\n        font-weight: 500;\r\n        color: #333;\r\n        margin-bottom: 16rpx;\r\n        display: block;\r\n      }\r\n      \r\n      .desc-content {\r\n        font-size: 28rpx;\r\n        color: #666;\r\n        line-height: 1.6;\r\n      }\r\n    }\r\n  }\r\n  \r\n  .bottom-bar {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    padding: 20rpx 30rpx;\r\n    background: #fff;\r\n    box-shadow: 0 -4rpx 16rpx rgba(0,0,0,0.05);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    \r\n    .quantity-control {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 20rpx;\r\n      \r\n      .quantity {\r\n        font-size: 30rpx;\r\n        color: #333;\r\n        min-width: 60rpx;\r\n        text-align: center;\r\n      }\r\n      \r\n      .disabled {\r\n        opacity: 0.5;\r\n      }\r\n    }\r\n    \r\n    .add-to-cart {\r\n      background: #007AFF;\r\n      color: #fff;\r\n      padding: 20rpx 60rpx;\r\n      border-radius: 100rpx;\r\n      font-size: 28rpx;\r\n      border: none;\r\n      \r\n      &:active {\r\n        transform: scale(0.98);\r\n        background: darken(#007AFF, 10%);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style> ","import MiniProgramPage from 'E:/HBuilder/Project/MyOrderTest/pages/menu/detail.vue'\nwx.createPage(MiniProgramPage)"],"mappings":";;;;;;;;;;;;;;;;;;;;;IA6FA,IAAMA,QAAA,GAAWC,aAAA,CAAGC,GAAA,CAAC,EAAE;IACvB,IAAMC,QAAA,GAAWF,aAAA,CAAGC,GAAA,CAAC,CAAC;IACtB,IAAME,OAAA,GAAUH,aAAA,CAAGC,GAAA,CAAC,EAAE;IACtB,IAAMG,aAAA,GAAgBJ,aAAA,CAAGC,GAAA,CAAC,EAAE;IAG5B,IAAMI,YAAA,GAAeL,aAAA,CAAAM,QAAA,CAAS;MAAA,OAAM,CAAC,CAACH,OAAA,CAAQI,KAAK;IAAA;IAGnD,IAAMC,kBAAA;MAAA,IAAAC,IAAA,GAAAC,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAqB,SAAAC,QAAOC,EAAA;QAAA,IAAAC,GAAA;QAAA,OAAAJ,oBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAE9BnB,aAAA,CAAAqB,KAAA,CAAAC,KAAA,wCAAYR,EAAE;cAAAI,QAAA,CAAAE,IAAA;cAAA,OACIG,SAAA,CAAAC,OAAA,CAAQC,WAAA,CAAYX,EAAE;YAAA;cAAlCC,GAAA,GAAAG,QAAA,CAAAQ,IAAA;cACN1B,aAAA,CAAAqB,KAAA,CAAAC,KAAA,wCAAYP,GAAG;cACfhB,QAAA,CAASQ,KAAA,GAAQQ,GAAA,CAAIY,IAAA;cAAAT,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAU,EAAA,GAAAV,QAAA;cAErBlB,aAAA,CAAAqB,KAAA,CAAAC,KAAA,0CAAc,aAAAJ,QAAA,CAAAU,EAAA,CAAkB;cAChC5B,aAAA,CAAAqB,KAAA,CAAIQ,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cACZ,CAAK;YAAA;YAAA;cAAA,OAAAb,QAAA,CAAAc,IAAA;UAAA;QAAA,GAAAnB,OAAA;MAAA,CAEL;MAAA,gBAbML,mBAAAyB,EAAA;QAAA,OAAAxB,IAAA,CAAAyB,KAAA,OAAAC,SAAA;MAAA;IAAA,GAaN;IAGA,IAAMC,gBAAA,GAAmB,SAAnBA,iBAAA,EAAyB;MAC7BlC,QAAA,CAASK,KAAA;IACX;IAGA,IAAM8B,gBAAA,GAAmB,SAAnBA,iBAAA,EAAyB;MAC7B,IAAInC,QAAA,CAASK,KAAA,GAAQ,GAAG;QACtBL,QAAA,CAASK,KAAA;MACV;IACH;IAGA,IAAM+B,eAAA;MAAA,IAAAC,KAAA,GAAA7B,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAkB,SAAA4B,SAAA;QAAA,IAAAC,MAAA;QAAA,OAAA9B,oBAAA,GAAAK,IAAA,UAAA0B,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAxB,IAAA,GAAAwB,SAAA,CAAAvB,IAAA;YAAA;cAAAuB,SAAA,CAAAxB,IAAA;cAEdsB,MAAA,GAASG,WAAA,CAAKC,KAAA,CAACC,SAAA,EAAW;cAAA,IAC3BL,MAAA;gBAAAE,SAAA,CAAAvB,IAAA;gBAAA;cAAA;cACHpB,aAAA,CAAAqB,KAAA,CAAI0B,SAAA,CAAU;gBACZjB,KAAA,EAAO;gBACPkB,OAAA,EAAS;gBACTC,WAAA,EAAa;gBACbC,OAAA,EAAS,SAATA,QAAUnC,GAAA,EAAQ;kBAChB,IAAIA,GAAA,CAAIoC,OAAA,EAAS;oBACfnD,aAAA,CAAAqB,KAAA,CAAI+B,SAAA,CAAU;sBAAEC,GAAA,EAAK;oBAAkB,CAAE;kBAC1C;gBACF;cACT,CAAO;cAAA,OAAAV,SAAA,CAAAW,MAAA;YAAA;cAAAX,SAAA,CAAAvB,IAAA;cAAA,OAIGG,SAAA,CAAAgC,OAAA,CAAQC,YAAA,CAAa;gBACzBf,MAAA,EAAAA,MAAA;gBACAgB,UAAA,EAAY1D,QAAA,CAASQ,KAAA,CAAMO,EAAA;gBAC3BZ,QAAA,EAAUA,QAAA,CAASK;cACzB,CAAK;YAAA;cAEDP,aAAA,CAAAqB,KAAA,CAAIQ,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cACZ,CAAK;cAAAY,SAAA,CAAAvB,IAAA;cAAA;YAAA;cAAAuB,SAAA,CAAAxB,IAAA;cAAAwB,SAAA,CAAAf,EAAA,GAAAe,SAAA;cAED3C,aAAA,CAAAqB,KAAA,CAAAC,KAAA,0CAAc,SAAAqB,SAAA,CAAAf,EAAA,CAAc;cAC5B5B,aAAA,CAAAqB,KAAA,CAAIQ,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cACZ,CAAK;YAAA;YAAA;cAAA,OAAAY,SAAA,CAAAX,IAAA;UAAA;QAAA,GAAAQ,QAAA;MAAA,CAEL;MAAA,gBAlCMF,gBAAA;QAAA,OAAAC,KAAA,CAAAL,KAAA,OAAAC,SAAA;MAAA;IAAA,GAkCN;IAGA,IAAMuB,eAAA;MAAA,IAAAC,KAAA,GAAAjD,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAkB,SAAAgD,SAAA;QAAA,IAAA7C,GAAA;QAAA,OAAAJ,oBAAA,GAAAK,IAAA,UAAA6C,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAA3C,IAAA,GAAA2C,SAAA,CAAA1C,IAAA;YAAA;cAAA0C,SAAA,CAAA3C,IAAA;cAEpBnB,aAAA,CAAAqB,KAAA,CAAAC,KAAA,wCAAY,UAAUnB,OAAA,CAAQI,KAAK;cAAAuD,SAAA,CAAA1C,IAAA;cAAA,OACjBG,SAAA,CAAOC,OAAA,CAACkC,eAAA,CAAgB;gBACxCvD,OAAA,EAASA,OAAA,CAAQI;gBAAA;cACvB,CAAK;YAAA;cAFKQ,GAAA,GAAA+C,SAAA,CAAApC,IAAA;cAGNtB,aAAA,CAAcG,KAAA,GAAQQ,GAAA,CAAIY,IAAA,IAAQ,EAAE;cAAAmC,SAAA,CAAA1C,IAAA;cAAA;YAAA;cAAA0C,SAAA,CAAA3C,IAAA;cAAA2C,SAAA,CAAAlC,EAAA,GAAAkC,SAAA;cAEpC9D,aAAA,CAAAqB,KAAA,CAAAC,KAAA,0CAAc,SAAAwC,SAAA,CAAAlC,EAAA,CAAc;cAC5B5B,aAAA,CAAAqB,KAAA,CAAIQ,SAAA,CAAU;gBACZC,KAAA,EAAO;gBACPC,IAAA,EAAM;cACZ,CAAK;cACD3B,aAAA,CAAcG,KAAA,GAAQ,EAAE;YAAA;YAAA;cAAA,OAAAuD,SAAA,CAAA9B,IAAA;UAAA;QAAA,GAAA4B,QAAA;MAAA,CAE5B;MAAA,gBAfMF,gBAAA;QAAA,OAAAC,KAAA,CAAAzB,KAAA,OAAAC,SAAA;MAAA;IAAA,GAeN;IAGA,IAAM4B,UAAA,GAAa,SAAbA,WAAcjD,EAAA,EAAO;MACzBd,aAAA,CAAAqB,KAAA,CAAI2C,UAAA,CAAW;QACbX,GAAA,2BAAAY,MAAA,CAA8BnD,EAAE;MACpC,CAAG;IACH;IAEAd,aAAA,CAAAkE,SAAA,CAAU,YAAM;MACd,IAAMC,KAAA,GAAQC,eAAA,EAAiB;MAC/B,IAAMC,WAAA,GAAcF,KAAA,CAAMA,KAAA,CAAMG,MAAA,GAAS,CAAC;MAC1C,IAAAC,oBAAA,GAAuCF,WAAA,CAAYG,OAAA;QAA3C1D,EAAA,GAAAyD,oBAAA,CAAAzD,EAAA;QAAa2D,aAAA,GAAAF,oBAAA,CAATpE,OAAA;MAEZ,IAAIW,EAAA,EAAI;QACNN,kBAAA,CAAmBM,EAAE;MACtB,WAAU2D,aAAA,EAAe;QACxBtE,OAAA,CAAQI,KAAA,GAAQmE,kBAAA,CAAmBD,aAAa;QAChDf,eAAA,EAAiB;MAClB;IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzMDiB,EAAA,CAAGC,UAAA,CAAWC,eAAe","ignoreList":[]}