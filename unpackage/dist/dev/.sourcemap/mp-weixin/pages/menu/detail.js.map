{"version":3,"file":"detail.js","sources":["pages/menu/detail.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVudS9kZXRhaWwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"detail-container\">\r\n    <!-- 如果是搜索模式，显示搜索结果列表 -->\r\n    <template v-if=\"isSearchMode\">\r\n      <view class=\"search-result\">\r\n        <view class=\"result-header\">\r\n          <text class=\"result-title\">搜索\"{{ keyword }}\"</text>\r\n          <text class=\"result-count\"\r\n            >找到 {{ searchResults.length }} 个结果</text\r\n          >\r\n        </view>\r\n\r\n        <view class=\"result-list\">\r\n          <view\r\n            class=\"result-item\"\r\n            v-for=\"item in searchResults\"\r\n            :key=\"item.id\"\r\n            @tap=\"showDetail(item.id)\"\r\n          >\r\n            <image :src=\"item.imageUrl\" mode=\"aspectFill\" class=\"item-image\" />\r\n            <view class=\"item-info\">\r\n              <text class=\"item-name\">{{ item.name }}</text>\r\n              <text class=\"item-desc\">{{ item.description }}</text>\r\n              <view class=\"item-bottom\">\r\n                <text class=\"item-price\">¥{{ item.price }}</text>\r\n                <text class=\"sales-count\">月售 {{ item.salesCount }}</text>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </template>\r\n\r\n    <!-- 如果是详情模式，显示原有的详情内容 -->\r\n    <template v-else>\r\n      <!-- 菜品图片 -->\r\n      <image :src=\"menuItem.imageUrl\" mode=\"aspectFill\" class=\"food-image\" />\r\n\r\n      <!-- 菜品信息 -->\r\n      <view class=\"food-info\">\r\n        <view class=\"basic-info\">\r\n          <text class=\"food-name\">{{ menuItem.name }}</text>\r\n          <text class=\"food-price\">¥{{ menuItem.price }}</text>\r\n        </view>\r\n\r\n        <view class=\"sales-info\">\r\n          <text class=\"sales-count\">月售 {{ menuItem.salesCount }}</text>\r\n          <text class=\"recommend-tag\" v-if=\"menuItem.isRecommend\"\r\n            >店长推荐</text\r\n          >\r\n        </view>\r\n\r\n        <view class=\"description\">\r\n          <text class=\"desc-title\">菜品描述</text>\r\n          <text class=\"desc-content\">{{ menuItem.description }}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 底部操作栏 -->\r\n      <view class=\"bottom-bar\">\r\n        <view class=\"quantity-control\">\r\n          <uni-icons\r\n            type=\"minus\"\r\n            size=\"20\"\r\n            color=\"#999\"\r\n            @click=\"decreaseQuantity\"\r\n            :class=\"{ disabled: quantity <= 1 }\"\r\n          />\r\n          <text class=\"quantity\">{{ quantity }}</text>\r\n          <uni-icons\r\n            type=\"plus\"\r\n            size=\"20\"\r\n            color=\"#007AFF\"\r\n            @click=\"increaseQuantity\"\r\n          />\r\n        </view>\r\n\r\n        <button class=\"add-to-cart\" @tap=\"handleAddToCart\">加入购物车</button>\r\n      </view>\r\n    </template>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from \"vue\";\r\nimport { menuApi, cartApi } from \"@/api\";\r\nimport store from \"@/store\";\r\n\r\nconst menuItem = ref({});\r\nconst quantity = ref(1);\r\nconst keyword = ref(\"\");\r\nconst searchResults = ref([]);\r\n\r\n// 是否为搜索模式\r\nconst isSearchMode = computed(() => !!keyword.value);\r\n\r\n// 加入购物车\r\nconst handleAddToCart = async () => {\r\n  try {\r\n    const userId = store.getUserId();\r\n    if (!userId) {\r\n      uni.showModal({\r\n        title: \"提示\",\r\n        content: \"请先登录后再操作\",\r\n        confirmText: \"去登录\",\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            uni.switchTab({ url: \"/pages/user/user\" });\r\n          }\r\n        },\r\n      });\r\n      return;\r\n    }\r\n\r\n    await cartApi.saveCartItem({\r\n      userId: userId,\r\n      menuItemId: menuItem.value.id,\r\n      quantity: quantity.value,\r\n    });\r\n\r\n    uni.showToast({\r\n      title: \"已加入购物车\",\r\n      icon: \"success\",\r\n    });\r\n\r\n    // 可选：跳转到购物车页面\r\n    // uni.switchTab({ url: '/pages/cart/cart' });\r\n  } catch (error) {\r\n    console.error(\"添加到购物车失败:\", error);\r\n    uni.showToast({\r\n      title: \"添加失败\",\r\n      icon: \"none\",\r\n    });\r\n  }\r\n};\r\n\r\n// 获取菜品详情\r\nconst loadMenuItemDetail = async (id) => {\r\n  try {\r\n    if (!id) return;\r\n    console.log(\"加载菜品详情, id:\", id);\r\n    const res = await menuApi.getMenuItem(id);\r\n    menuItem.value = res;\r\n  } catch (error) {\r\n    console.error(\"获取菜品详情失败:\", error);\r\n    uni.showToast({\r\n      title: \"获取菜品详情失败\",\r\n      icon: \"none\",\r\n    });\r\n  }\r\n};\r\n\r\n// 搜索菜品\r\nconst searchMenuItems = async () => {\r\n  try {\r\n    if (!keyword.value) return;\r\n    console.log(\"搜索关键词:\", keyword.value);\r\n    const res = await menuApi.searchMenuItems(keyword.value);\r\n    searchResults.value = res || [];\r\n  } catch (error) {\r\n    console.error(\"搜索失败:\", error);\r\n    uni.showToast({\r\n      title: \"搜索失败\",\r\n      icon: \"none\",\r\n    });\r\n    searchResults.value = [];\r\n  }\r\n};\r\n\r\n// 增加数量\r\nconst increaseQuantity = () => {\r\n  quantity.value++;\r\n};\r\n\r\n// 减少数量\r\nconst decreaseQuantity = () => {\r\n  if (quantity.value > 1) {\r\n    quantity.value--;\r\n  }\r\n};\r\n\r\n// 显示菜品详情\r\nconst showDetail = (id) => {\r\n  uni.redirectTo({\r\n    url: `/pages/menu/detail?id=${id}`,\r\n  });\r\n};\r\n\r\nonMounted(() => {\r\n  // 获取当前页面实例\r\n  const pages = getCurrentPages();\r\n  const currentPage = pages[pages.length - 1];\r\n\r\n  // 获取页面参数\r\n  const options = currentPage.$page?.options || currentPage.options || {};\r\n  console.log(\"页面参数:\", options);\r\n\r\n  const { id, keyword: searchKeyword } = options;\r\n\r\n  if (id) {\r\n    // 如果有id参数，加载菜品详情\r\n    loadMenuItemDetail(id);\r\n  } else if (searchKeyword) {\r\n    // 如果有搜索关键词，进行搜索\r\n    keyword.value = decodeURIComponent(searchKeyword);\r\n    searchMenuItems();\r\n  }\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.detail-container {\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n\r\n  .search-result {\r\n    padding: 30rpx;\r\n\r\n    .result-header {\r\n      margin-bottom: 30rpx;\r\n\r\n      .result-title {\r\n        font-size: 32rpx;\r\n        font-weight: bold;\r\n        color: #333;\r\n        display: block;\r\n      }\r\n\r\n      .result-count {\r\n        font-size: 24rpx;\r\n        color: #999;\r\n        margin-top: 8rpx;\r\n        display: block;\r\n      }\r\n    }\r\n\r\n    .result-list {\r\n      .result-item {\r\n        display: flex;\r\n        background: #fff;\r\n        padding: 20rpx;\r\n        border-radius: 16rpx;\r\n        margin-bottom: 20rpx;\r\n\r\n        .item-image {\r\n          width: 160rpx;\r\n          height: 160rpx;\r\n          border-radius: 12rpx;\r\n          margin-right: 20rpx;\r\n        }\r\n\r\n        .item-info {\r\n          flex: 1;\r\n          display: flex;\r\n          flex-direction: column;\r\n\r\n          .item-name {\r\n            font-size: 30rpx;\r\n            font-weight: 500;\r\n            color: #333;\r\n          }\r\n\r\n          .item-desc {\r\n            font-size: 26rpx;\r\n            color: #999;\r\n            margin: 12rpx 0;\r\n            display: -webkit-box;\r\n            -webkit-box-orient: vertical;\r\n            -webkit-line-clamp: 2;\r\n            overflow: hidden;\r\n          }\r\n\r\n          .item-bottom {\r\n            margin-top: auto;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n\r\n            .item-price {\r\n              font-size: 32rpx;\r\n              color: #ff5a5f;\r\n              font-weight: bold;\r\n            }\r\n\r\n            .sales-count {\r\n              font-size: 24rpx;\r\n              color: #999;\r\n            }\r\n          }\r\n        }\r\n\r\n        &:active {\r\n          transform: scale(0.98);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .food-image {\r\n    width: 100%;\r\n    height: 500rpx;\r\n  }\r\n\r\n  .food-info {\r\n    margin-top: -40rpx;\r\n    padding: 40rpx 30rpx;\r\n    background: #fff;\r\n    border-radius: 40rpx 40rpx 0 0;\r\n    position: relative;\r\n\r\n    .basic-info {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 20rpx;\r\n\r\n      .food-name {\r\n        font-size: 36rpx;\r\n        font-weight: bold;\r\n        color: #333;\r\n      }\r\n\r\n      .food-price {\r\n        font-size: 36rpx;\r\n        color: #ff5a5f;\r\n        font-weight: bold;\r\n      }\r\n    }\r\n\r\n    .sales-info {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 20rpx;\r\n      margin-bottom: 30rpx;\r\n\r\n      .sales-count {\r\n        font-size: 24rpx;\r\n        color: #999;\r\n      }\r\n\r\n      .recommend-tag {\r\n        padding: 4rpx 16rpx;\r\n        background: #fff5e6;\r\n        color: #ff9500;\r\n        font-size: 24rpx;\r\n        border-radius: 100rpx;\r\n      }\r\n    }\r\n\r\n    .description {\r\n      .desc-title {\r\n        font-size: 30rpx;\r\n        font-weight: 500;\r\n        color: #333;\r\n        margin-bottom: 16rpx;\r\n        display: block;\r\n      }\r\n\r\n      .desc-content {\r\n        font-size: 28rpx;\r\n        color: #666;\r\n        line-height: 1.6;\r\n      }\r\n    }\r\n  }\r\n\r\n  .bottom-bar {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    padding: 20rpx 30rpx;\r\n    background: #fff;\r\n    box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.05);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n\r\n    .quantity-control {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 20rpx;\r\n\r\n      .quantity {\r\n        font-size: 30rpx;\r\n        color: #333;\r\n        min-width: 60rpx;\r\n        text-align: center;\r\n      }\r\n\r\n      .disabled {\r\n        opacity: 0.5;\r\n      }\r\n    }\r\n\r\n    .add-to-cart {\r\n      background: #007aff;\r\n      color: #fff;\r\n      padding: 20rpx 60rpx;\r\n      border-radius: 100rpx;\r\n      font-size: 28rpx;\r\n      border: none;\r\n\r\n      &:active {\r\n        transform: scale(0.98);\r\n        background: darken(#007aff, 10%);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/HBuilder/Project/MyOrderTest/pages/menu/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","store","uni","cartApi","menuApi","onMounted"],"mappings":"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"}