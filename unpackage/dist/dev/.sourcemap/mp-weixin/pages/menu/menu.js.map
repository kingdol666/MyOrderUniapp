{"version":3,"file":"menu.js","sources":["pages/menu/menu.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVudS9tZW51LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"menu-container\">\n    <!-- 顶部搜索区 -->\n    <view class=\"search-header\">\n      <view class=\"search-box\">\n        <uni-search-bar\n          class=\"search-bar\"\n          radius=\"100\"\n          placeholder=\"探索美食...\"\n          v-model=\"searchKeyword\"\n          @confirm=\"handleSearch\"\n          bgColor=\"#f5f6f7\"\n          cancelButton=\"none\"\n        >\n          <template v-slot:searchIcon>\n            <uni-icons color=\"#666\" size=\"18\" type=\"search\" />\n          </template>\n        </uni-search-bar>\n\n        <!-- 热门搜索标签 -->\n        <scroll-view scroll-x class=\"hot-search\" :show-scrollbar=\"false\">\n          <view class=\"tag-list\">\n            <view\n              class=\"search-tag\"\n              v-for=\"(tag, index) in hotSearchTags\"\n              :key=\"index\"\n              @tap=\"quickSearch(tag)\"\n            >\n              {{ tag }}\n            </view>\n          </view>\n        </scroll-view>\n      </view>\n    </view>\n\n    <!-- 分类导航 -->\n    <scroll-view\n      scroll-x\n      class=\"category-scroll\"\n      :show-scrollbar=\"false\"\n      enhanced\n    >\n      <view class=\"category-list\">\n        <view\n          v-for=\"item in categories\"\n          :key=\"item.id\"\n          class=\"category-item\"\n          :class=\"{ active: currentCategoryId === item.id }\"\n          @tap=\"selectCategory(item.id)\"\n        >\n          <text class=\"category-name\">{{ item.name }}</text>\n          <view class=\"active-line\" v-if=\"currentCategoryId === item.id\"></view>\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 菜品列表 -->\n    <scroll-view\n      scroll-y\n      class=\"menu-scroll\"\n      refresher-enabled\n      :refresher-triggered=\"isRefreshing\"\n      @refresherrefresh=\"onRefresh\"\n      @scrolltolower=\"loadMore\"\n      enhanced\n      :show-scrollbar=\"false\"\n    >\n      <view class=\"menu-grid\">\n        <view\n          class=\"menu-item\"\n          v-for=\"(item, index) in menuItems\"\n          :key=\"item.id\"\n          :style=\"{ animationDelay: index * 0.05 + 's' }\"\n          @tap=\"navigateToDetail(item)\"\n        >\n          <view class=\"item-content\">\n            <view class=\"image-wrapper\">\n              <image\n                :src=\"item.imageUrl || '/static/default-food.png'\"\n                mode=\"aspectFill\"\n                class=\"food-img\"\n                @error=\"handleImageError\"\n              />\n              <view class=\"tag-wrapper\" v-if=\"item.isRecommend\">\n                <uni-tag\n                  text=\"推荐\"\n                  type=\"warning\"\n                  size=\"small\"\n                  customStyle=\"background: linear-gradient(135deg, #ff6b6b, #ff8787)\"\n                />\n              </view>\n            </view>\n            <view class=\"food-info\">\n              <text class=\"food-name\">{{ item.name }}</text>\n              <text class=\"food-desc\">{{ item.description }}</text>\n              <view class=\"bottom-info\">\n                <view class=\"price-box\">\n                  <text class=\"symbol\">¥</text>\n                  <text class=\"price\">{{ item.price }}</text>\n                  <text class=\"sales\">已售 {{ item.salesCount }}</text>\n                </view>\n                <view class=\"add-btn\" @tap.stop=\"addToCart(item)\">\n                  <uni-icons type=\"plus\" size=\"24\" color=\"#fff\" />\n                </view>\n              </view>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 加载更多 -->\n      <uni-load-more :status=\"loadMoreStatus\" iconType=\"circle\" />\n    </scroll-view>\n  </view>\n</template>\n\n<script>\nimport { menuApi, cartApi, categoryApi } from \"@/api\";\nimport store from \"@/store\";\nimport { ref, onMounted } from \"vue\";\n\nexport default {\n  data() {\n    return {\n      searchKeyword: \"\",\n      currentCategoryId: store.getCurrentCategoryId(),\n      categories: [],\n      menuItems: [],\n      isRefreshing: false,\n      loadMoreStatus: \"more\",\n      page: 1,\n      loading: false,\n    };\n  },\n\n  async onShow() {\n    await this.loadCategories();\n    await this.loadMenuItems();\n    console.log(\"当前分类ID:\", this.currentCategoryId);\n    const ctgId = store.getCurrentCategoryId();\n    if (ctgId !== null) {\n      await this.selectCategory(ctgId);\n    } else {\n      await this.selectCategory(this.categories[0].id);\n    }\n  },\n\n  methods: {\n    // 处理搜索\n    async handleSearch(e) {\n      if (!this.searchKeyword.trim()) {\n        uni.showToast({\n          title: \"请输入搜索关键词\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      // 跳转到详情页并传递搜索关键词\n      uni.navigateTo({\n        url: `/pages/menu/detail?keyword=${encodeURIComponent(\n          this.searchKeyword.trim()\n        )}`,\n      });\n    },\n\n    // 加载分类\n    async loadCategories() {\n      try {\n        const categories = await categoryApi.getAllCategories();\n        this.categories = categories;\n     \n      } catch (error) {\n        console.error(\"加载分类失败:\", error);\n        uni.showToast({\n          title: \"加载分类失败\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    // 选择分类\n    async selectCategory(categoryId) {\n      try {\n        if (!categoryId) {\n          console.warn(\"selectCategory: categoryId is missing.\");\n          return;\n        }\n        if (this.currentCategoryId === categoryId) {\n          console.log(\"选中的分类相同，刷新菜单:\", categoryId);\n          await this.loadMenuItems();\n          return;\n        }\n        // 更新当前分类\n        this.currentCategoryId = categoryId;\n        store.setCurrentCategoryId(categoryId);\n        console.log(\"切换到新分类:\", categoryId);\n        await this.loadMenuItems();\n      } catch (error) {\n        console.error(\"selectCategory encountered an error:\", error);\n      }\n    },\n\n    // 加载菜品\n    async loadMenuItems() {\n      try {\n        this.loading = true;\n        const currentId = store.getCurrentCategoryId();\n        if (currentId === null) {\n          await this.selectCategory(this.categories[0].id);\n        }\n        const res = await menuApi.getMenuItemsByCategory(\n          this.currentCategoryId\n        );\n        this.menuItems = res;\n      } catch (error) {\n        if (error.errMsg !== \"request:fail abort\") {\n          console.error(\"加载菜品失败:\", error);\n          uni.showToast({\n            title: \"加载菜品失败\",\n            icon: \"none\",\n          });\n        }\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 下拉刷新\n    async onRefresh() {\n      this.isRefreshing = true;\n      await this.loadCategories();\n      await this.loadMenuItems();\n\n      this.isRefreshing = false;\n      uni.stopPullDownRefresh();\n    },\n\n    // 添加到购物车\n    async addToCart(item) {\n      try {\n        const userId = store.getUserId();\n        if (!userId) {\n          uni.showModal({\n            title: \"提示\",\n            content: \"请先登录后再操作\",\n            confirmText: \"去登录\",\n            success: (res) => {\n              if (res.confirm) {\n                uni.switchTab({ url: \"/pages/user/user\" });\n              }\n            },\n          });\n          return;\n        }\n\n        await cartApi.saveCartItem({\n          userId,\n          menuItemId: item.id,\n          quantity: 1,\n        });\n\n        uni.showToast({\n          title: \"已加入购物车\",\n          icon: \"success\",\n        });\n\n        await store.updateCartBadge();\n      } catch (error) {\n        console.error(\"添加到购物车失败:\", error);\n        uni.showToast({\n          title: \"添加失败\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    handleImageError(e) {\n      console.error(\"图片加载失败:\", e);\n      e.target.src = \"/static/default-food.png\";\n    },\n\n    async updateCartCount() {\n      const userId = this.$store.getUserId();\n      if (userId) {\n        try {\n          const response = await cartApi.getCartItems(userId);\n          this.cartItemCount = response.reduce(\n            (sum, item) => sum + item.quantity,\n            0\n          );\n        } catch (error) {\n          console.error(\"获取购物车失败:\", error);\n        }\n      }\n    },\n\n    // 跳转到详情页\n    navigateToDetail(item) {\n      uni.navigateTo({\n        url: `/pages/menu/detail?id=${item.id}`,\n      });\n    },\n\n    loadMore() {\n      if (this.loadMoreStatus === \"noMore\") return;\n      this.loadMoreStatus = \"loading\";\n      setTimeout(() => {\n        // 模拟加载更多数据\n        this.loadMoreStatus = \"noMore\";\n      }, 1000);\n    },\n\n    refreshList() {\n      this.page = 1;\n      // 重新加载列表数据\n    },\n\n    // 热门搜索标签\n    hotSearchTags: ref([\"热销套餐\", \"今日特价\", \"新品上市\", \"店长推荐\"]),\n\n    // 快速搜索\n    quickSearch(keyword) {\n      this.searchKeyword = keyword;\n      this.handleSearch();\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n// 文本省略 mixin\n@mixin text-ellipsis($lines) {\n  @if $lines == 1 {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  } @else {\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: $lines;\n    overflow: hidden;\n  }\n}\n\n.menu-container {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);\n\n  .search-header {\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    padding: 20rpx;\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(20px);\n    border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n\n    .search-box {\n      .search-bar {\n        :deep(.uni-searchbar) {\n          padding: 0;\n\n          .uni-searchbar__box {\n            justify-content: flex-start;\n            padding: 0 30rpx;\n            height: 72rpx;\n            border-radius: 36rpx;\n            background: #f5f6f7;\n\n            .uni-searchbar__text-input {\n              font-size: 28rpx;\n              color: #333;\n            }\n          }\n        }\n      }\n\n      .hot-search {\n        margin-top: 20rpx;\n        white-space: nowrap;\n\n        .tag-list {\n          display: inline-flex;\n          padding: 0 10rpx;\n\n          .search-tag {\n            display: inline-block;\n            padding: 8rpx 24rpx;\n            margin-right: 16rpx;\n            background: #f5f6f7;\n            color: #666;\n            font-size: 24rpx;\n            border-radius: 28rpx;\n            transition: all 0.3s;\n\n            &:active {\n              transform: scale(0.95);\n              background: #e8e9eb;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  .category-scroll {\n    background: #ffffff;\n    padding: 20rpx 0;\n    white-space: nowrap;\n    border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n\n    .category-list {\n      padding: 0 20rpx;\n      display: flex;\n\n      .category-item {\n        position: relative;\n        padding: 16rpx 40rpx;\n        margin-right: 20rpx;\n        background: #f8f9fa;\n        border-radius: 100rpx;\n        transition: all 0.3s;\n        cursor: pointer;\n\n        &.active {\n          background: linear-gradient(135deg, #007aff, #00b4ff);\n          box-shadow: 0 4rpx 12rpx rgba(0, 122, 255, 0.3);\n\n          .category-name {\n            color: #fff;\n          }\n\n          .active-line {\n            position: absolute;\n            bottom: -4rpx;\n            left: 50%;\n            transform: translateX(-50%);\n            width: 20rpx;\n            height: 4rpx;\n            background: #fff;\n            border-radius: 4rpx;\n          }\n        }\n\n        .category-name {\n          font-size: 28rpx;\n          color: #666;\n          font-weight: 500;\n        }\n\n        &:active {\n          transform: scale(0.95);\n        }\n      }\n    }\n  }\n\n  .menu-scroll {\n    height: calc(100vh - 220rpx);\n\n    .menu-grid {\n      padding: 20rpx;\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 30rpx;\n\n      .menu-item {\n        animation: fadeInUp 0.5s ease-out forwards;\n        opacity: 0;\n\n        @keyframes fadeInUp {\n          from {\n            opacity: 0;\n            transform: translateY(30rpx);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n\n        .item-content {\n          background: #ffffff;\n          border-radius: 24rpx;\n          overflow: hidden;\n          box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.06);\n          transition: all 0.3s;\n\n          &:active {\n            transform: scale(0.98);\n          }\n\n          .image-wrapper {\n            position: relative;\n\n            .food-img {\n              width: 100%;\n              height: 300rpx;\n              background: #f8f9fa;\n            }\n\n            .tag-wrapper {\n              position: absolute;\n              top: 16rpx;\n              right: 16rpx;\n            }\n          }\n\n          .food-info {\n            padding: 20rpx;\n\n            .food-name {\n              font-size: 28rpx;\n              font-weight: 600;\n              color: #333;\n              margin-bottom: 8rpx;\n            }\n\n            .food-desc {\n              font-size: 24rpx;\n              color: #999;\n              line-height: 1.4;\n              height: 68rpx;\n              @include text-ellipsis(2);\n            }\n\n            .bottom-info {\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-top: 16rpx;\n\n              .price-box {\n                display: flex;\n                align-items: baseline;\n\n                .symbol {\n                  font-size: 24rpx;\n                  color: #ff6b6b;\n                }\n\n                .price {\n                  font-size: 36rpx;\n                  font-weight: bold;\n                  color: #ff6b6b;\n                  margin: 0 8rpx;\n                }\n\n                .sales {\n                  font-size: 22rpx;\n                  color: #999;\n                }\n              }\n\n              .add-btn {\n                width: 56rpx;\n                height: 56rpx;\n                background: linear-gradient(135deg, #007aff, #00b4ff);\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 4rpx 12rpx rgba(0, 122, 255, 0.3);\n                transition: all 0.3s;\n\n                &:active {\n                  transform: scale(0.9);\n                  box-shadow: 0 2rpx 6rpx rgba(0, 122, 255, 0.2);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from 'E:/HBuilder/Project/MyOrderTest/pages/menu/menu.vue'\nwx.createPage(MiniProgramPage)"],"names":["store","uni","categoryApi","menuApi","cartApi","ref"],"mappings":";;;;AAyHA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,eAAe;AAAA,MACf,mBAAmBA,YAAK,MAAC,qBAAsB;AAAA,MAC/C,YAAY,CAAE;AAAA,MACd,WAAW,CAAE;AAAA,MACb,cAAc;AAAA,MACd,gBAAgB;AAAA,MAChB,MAAM;AAAA,MACN,SAAS;AAAA;EAEZ;AAAA,EAED,MAAM,SAAS;AACb,UAAM,KAAK;AACX,UAAM,KAAK;AACXC,kBAAY,MAAA,MAAA,OAAA,8BAAA,WAAW,KAAK,iBAAiB;AAC7C,UAAM,QAAQD,kBAAM;AACpB,QAAI,UAAU,MAAM;AAClB,YAAM,KAAK,eAAe,KAAK;AAAA,WAC1B;AACL,YAAM,KAAK,eAAe,KAAK,WAAW,CAAC,EAAE,EAAE;AAAA,IACjD;AAAA,EACD;AAAA,EAED,SAAS;AAAA;AAAA,IAEP,MAAM,aAAa,GAAG;AACpB,UAAI,CAAC,KAAK,cAAc,QAAQ;AAC9BC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AACD;AAAA,MACF;AAGAA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,8BAA8B;AAAA,UACjC,KAAK,cAAc,KAAK;AAAA,QAC1B,CAAC;AAAA,MACH,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,MAAM,iBAAiB;AACrB,UAAI;AACF,cAAM,aAAa,MAAMC,sBAAY;AACrC,aAAK,aAAa;AAAA,MAElB,SAAO,OAAO;AACdD,sBAAA,MAAA,MAAA,SAAA,8BAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,eAAe,YAAY;AAC/B,UAAI;AACF,YAAI,CAAC,YAAY;AACfA,wBAAAA,MAAa,MAAA,QAAA,8BAAA,wCAAwC;AACrD;AAAA,QACF;AACA,YAAI,KAAK,sBAAsB,YAAY;AACzCA,wBAAA,MAAA,MAAA,OAAA,8BAAY,iBAAiB,UAAU;AACvC,gBAAM,KAAK;AACX;AAAA,QACF;AAEA,aAAK,oBAAoB;AACzBD,0BAAM,qBAAqB,UAAU;AACrCC,sBAAA,MAAA,MAAA,OAAA,8BAAY,WAAW,UAAU;AACjC,cAAM,KAAK;MACX,SAAO,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,8BAAc,wCAAwC,KAAK;AAAA,MAC7D;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,gBAAgB;AACpB,UAAI;AACF,aAAK,UAAU;AACf,cAAM,YAAYD,kBAAM;AACxB,YAAI,cAAc,MAAM;AACtB,gBAAM,KAAK,eAAe,KAAK,WAAW,CAAC,EAAE,EAAE;AAAA,QACjD;AACA,cAAM,MAAM,MAAMG,UAAAA,QAAQ;AAAA,UACxB,KAAK;AAAA;AAEP,aAAK,YAAY;AAAA,MACjB,SAAO,OAAO;AACd,YAAI,MAAM,WAAW,sBAAsB;AACzCF,wBAAc,MAAA,MAAA,SAAA,8BAAA,WAAW,KAAK;AAC9BA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACR,CAAC;AAAA,QACH;AAAA,MACF,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,YAAY;AAChB,WAAK,eAAe;AACpB,YAAM,KAAK;AACX,YAAM,KAAK;AAEX,WAAK,eAAe;AACpBA,oBAAG,MAAC,oBAAmB;AAAA,IACxB;AAAA;AAAA,IAGD,MAAM,UAAU,MAAM;AACpB,UAAI;AACF,cAAM,SAASD,kBAAM;AACrB,YAAI,CAAC,QAAQ;AACXC,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,SAAS;AAAA,YACT,aAAa;AAAA,YACb,SAAS,CAAC,QAAQ;AAChB,kBAAI,IAAI,SAAS;AACfA,8BAAAA,MAAI,UAAU,EAAE,KAAK,mBAAoB,CAAA;AAAA,cAC3C;AAAA,YACD;AAAA,UACH,CAAC;AACD;AAAA,QACF;AAEA,cAAMG,UAAAA,QAAQ,aAAa;AAAA,UACzB;AAAA,UACA,YAAY,KAAK;AAAA,UACjB,UAAU;AAAA,QACZ,CAAC;AAEDH,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAED,cAAMD,YAAAA,MAAM;MACZ,SAAO,OAAO;AACdC,sBAAc,MAAA,MAAA,SAAA,8BAAA,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AAAA,MACH;AAAA,IACD;AAAA,IAED,iBAAiB,GAAG;AAClBA,oBAAA,MAAA,MAAA,SAAA,8BAAc,WAAW,CAAC;AAC1B,QAAE,OAAO,MAAM;AAAA,IAChB;AAAA,IAED,MAAM,kBAAkB;AACtB,YAAM,SAAS,KAAK,OAAO,UAAS;AACpC,UAAI,QAAQ;AACV,YAAI;AACF,gBAAM,WAAW,MAAMG,UAAAA,QAAQ,aAAa,MAAM;AAClD,eAAK,gBAAgB,SAAS;AAAA,YAC5B,CAAC,KAAK,SAAS,MAAM,KAAK;AAAA,YAC1B;AAAA;QAEF,SAAO,OAAO;AACdH,wBAAA,MAAA,MAAA,SAAA,8BAAc,YAAY,KAAK;AAAA,QACjC;AAAA,MACF;AAAA,IACD;AAAA;AAAA,IAGD,iBAAiB,MAAM;AACrBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,yBAAyB,KAAK,EAAE;AAAA,MACvC,CAAC;AAAA,IACF;AAAA,IAED,WAAW;AACT,UAAI,KAAK,mBAAmB;AAAU;AACtC,WAAK,iBAAiB;AACtB,iBAAW,MAAM;AAEf,aAAK,iBAAiB;AAAA,MACvB,GAAE,GAAI;AAAA,IACR;AAAA,IAED,cAAc;AACZ,WAAK,OAAO;AAAA,IAEb;AAAA;AAAA,IAGD,eAAeI,cAAG,IAAC,CAAC,QAAQ,QAAQ,QAAQ,MAAM,CAAC;AAAA;AAAA,IAGnD,YAAY,SAAS;AACnB,WAAK,gBAAgB;AACrB,WAAK,aAAY;AAAA,IAClB;AAAA,EACF;AACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtUA,GAAG,WAAW,eAAe;"}