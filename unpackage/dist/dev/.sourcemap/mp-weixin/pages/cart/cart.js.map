{"version":3,"file":"cart.js","sources":["pages/cart/cart.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9jYXJ0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"cart-container\">\r\n    <!-- 空购物车提示 -->\r\n    <view v-if=\"cartItems.length === 0\" class=\"empty-cart\">\r\n      <uni-icons type=\"cart\" size=\"64\" color=\"#999\" />\r\n      <text class=\"empty-text\">购物车是空的</text>\r\n      <button class=\"go-shopping\" @click=\"navigateToMenu\">去逛逛</button>\r\n    </view>\r\n\r\n    <!-- 购物车列表 -->\r\n    <view v-else class=\"cart-content\">\r\n      <view class=\"cart-list\">\r\n        <view class=\"cart-item\" v-for=\"item in cartItems\" :key=\"item.id\">\r\n          <image :src=\"item.itemImageUrl\" mode=\"aspectFill\" class=\"food-img\" />\r\n          <view class=\"item-info\">\r\n            <text class=\"item-name\">{{ item.itemName }}</text>\r\n            <text class=\"item-price\">¥{{ item.itemPrice }}</text>\r\n            <view class=\"quantity-control\">\r\n              <uni-icons\r\n                type=\"minus\"\r\n                size=\"20\"\r\n                :color=\"item.quantity <= 1 ? '#ccc' : '#007AFF'\"\r\n                @click=\"decreaseQuantity(item)\"\r\n              />\r\n              <text class=\"quantity\">{{ item.quantity }}</text>\r\n              <uni-icons\r\n                type=\"plus\"\r\n                size=\"20\"\r\n                color=\"#007AFF\"\r\n                @click=\"increaseQuantity(item)\"\r\n              />\r\n            </view>\r\n          </view>\r\n          <uni-icons\r\n            type=\"trash\"\r\n            size=\"24\"\r\n            color=\"#ff5a5f\"\r\n            @click=\"removeItem(item)\"\r\n            class=\"delete-btn\"\r\n          />\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 结算栏 -->\r\n      <view class=\"checkout-bar\">\r\n        <view class=\"total-info\">\r\n          <text class=\"total-label\">合计:</text>\r\n          <text class=\"total-price\">¥{{ totalAmount }}</text>\r\n        </view>\r\n        <button\r\n          class=\"checkout-btn\"\r\n          :disabled=\"cartItems.length === 0\"\r\n          @click=\"checkout\"\r\n        >\r\n          去结算\r\n        </button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { cartApi, orderApi } from \"@/api\";\r\nimport store from \"@/store\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      cartItems: [],\r\n      userId: \"\",\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    totalAmount() {\r\n      return this.cartItems\r\n        .reduce((sum, item) => {\r\n          return sum + item.itemPrice * item.quantity;\r\n        }, 0)\r\n        .toFixed(2);\r\n    },\r\n  },\r\n\r\n  onShow() {\r\n    this.userId = store.getUserId();\r\n    if (!this.userId) {\r\n      uni.showModal({\r\n        title: \"提示\",\r\n        content: \"请先登录后再查看购物车\",\r\n        showCancel: false,\r\n        success: () => {\r\n          uni.switchTab({\r\n            url: \"/pages/menu/menu\",\r\n          });\r\n        },\r\n      });\r\n      return;\r\n    }\r\n    this.loadCartItems();\r\n    store.updateCartBadge();\r\n  },\r\n\r\n  methods: {\r\n    async loadCartItems() {\r\n      try {\r\n        this.cartItems = await cartApi.getCartItems(this.userId);\r\n        console.log(this.cartItems);\r\n        console.log(\"购物车数据:\", this.cartItems);\r\n      } catch (error) {\r\n        console.error(\"加载购物车失败:\", error);\r\n        uni.showToast({\r\n          title: \"加载购物车失败\",\r\n          icon: \"none\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 减少数量\r\n    async decreaseQuantity(item) {\r\n      if (item.quantity <= 1) return;\r\n      try {\r\n        await cartApi.saveCartItem({\r\n          userId: this.userId,\r\n          menuItemId: item.menuItemId,\r\n          quantity: -1,\r\n        });\r\n        await this.loadCartItems();\r\n        await store.updateCartBadge();\r\n      } catch (error) {\r\n        console.error(\"减少数量失败:\", error);\r\n        uni.showToast({\r\n          title: \"操作失败\",\r\n          icon: \"none\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 增加数量\r\n    async increaseQuantity(item) {\r\n      try {\r\n        await cartApi.saveCartItem({\r\n          userId: this.userId,\r\n          menuItemId: item.menuItemId,\r\n          quantity: 1,\r\n        });\r\n        await this.loadCartItems();\r\n        await store.updateCartBadge();\r\n      } catch (error) {\r\n        console.error(\"增加数量失败:\", error);\r\n        uni.showToast({\r\n          title: \"操作失败\",\r\n          icon: \"none\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 删除商品\r\n    async removeItem(item) {\r\n      try {\r\n        await cartApi.removeCartItem(this.userId, item.menuItemId);\r\n        await this.loadCartItems();\r\n        await store.updateCartBadge();\r\n        uni.showToast({\r\n          title: \"删除成功\",\r\n          icon: \"success\",\r\n        });\r\n      } catch (error) {\r\n        console.error(\"删除失败:\", error);\r\n        uni.showToast({\r\n          title: \"删除失败\",\r\n          icon: \"none\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 跳转到菜单页\r\n    navigateToMenu() {\r\n      uni.switchTab({\r\n        url: \"/pages/menu/menu\",\r\n      });\r\n    },\r\n\r\n    // 去结算\r\n    async checkout() {\r\n      if (this.cartItems.length === 0) return;\r\n      try {\r\n        const order = await orderApi.createOrder(this.userId);\r\n        console.log(order);\r\n        uni.navigateTo({\r\n          url: `/pages/checkout/checkout?orderId=${order.id}`,\r\n        });\r\n      } catch (error) {\r\n        console.error(\"创建订单失败:\", error);\r\n        uni.showToast({\r\n          title: \"创建订单失败\",\r\n          icon: \"none\",\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.cart-container {\r\n  min-height: 100vh;\r\n  background: linear-gradient(180deg, #f6f7f9 0%, #ffffff 100%);\r\n  padding-bottom: 120rpx;\r\n\r\n  .empty-cart {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-top: 200rpx;\r\n\r\n    .empty-text {\r\n      color: #999;\r\n      font-size: 28rpx;\r\n      margin: 30rpx 0;\r\n    }\r\n\r\n    .go-shopping {\r\n      background: #007aff;\r\n      color: #fff;\r\n      padding: 20rpx 60rpx;\r\n      border-radius: 100rpx;\r\n      font-size: 28rpx;\r\n      border: none;\r\n\r\n      &:active {\r\n        background: darken(#007aff, 10%);\r\n      }\r\n    }\r\n  }\r\n\r\n  .cart-content {\r\n    padding: 20rpx;\r\n\r\n    .cart-list {\r\n      .cart-item {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 20rpx;\r\n        background: #ffffff;\r\n        border-radius: 20rpx;\r\n        margin-bottom: 20rpx;\r\n        box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.06);\r\n\r\n        .food-img {\r\n          width: 140rpx;\r\n          height: 140rpx;\r\n          border-radius: 16rpx;\r\n          margin-right: 20rpx;\r\n        }\r\n\r\n        .item-info {\r\n          flex: 1;\r\n\r\n          .item-name {\r\n            font-size: 28rpx;\r\n            color: #333;\r\n            font-weight: 500;\r\n          }\r\n\r\n          .item-price {\r\n            font-size: 32rpx;\r\n            color: #007aff;\r\n            font-weight: bold;\r\n            margin: 10rpx 0;\r\n          }\r\n\r\n          .quantity-control {\r\n            display: flex;\r\n            align-items: center;\r\n            margin-top: 16rpx;\r\n\r\n            .quantity {\r\n              margin: 0 30rpx;\r\n              font-size: 28rpx;\r\n              color: #333;\r\n            }\r\n          }\r\n        }\r\n\r\n        .delete-btn {\r\n          padding: 20rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .checkout-bar {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 20rpx 30rpx;\r\n    background: rgba(255, 255, 255, 0.9);\r\n    backdrop-filter: blur(20px);\r\n    box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.06);\r\n\r\n    .total-info {\r\n      .total-label {\r\n        font-size: 28rpx;\r\n        color: #666;\r\n      }\r\n\r\n      .total-price {\r\n        font-size: 36rpx;\r\n        color: #007aff;\r\n        font-weight: bold;\r\n        margin-left: 16rpx;\r\n      }\r\n    }\r\n\r\n    .checkout-btn {\r\n      background: #007aff;\r\n      color: #fff;\r\n      padding: 20rpx 60rpx;\r\n      border-radius: 100rpx;\r\n      font-size: 28rpx;\r\n      border: none;\r\n\r\n      &:disabled {\r\n        background: #ccc;\r\n      }\r\n\r\n      &:active {\r\n        background: darken(#007aff, 10%);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// 暗黑模式适配\r\n@media (prefers-color-scheme: dark) {\r\n  .cart-container {\r\n    background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%);\r\n\r\n    .cart-item {\r\n      background: rgba(255, 255, 255, 0.05) !important;\r\n\r\n      .item-name {\r\n        color: #fff !important;\r\n      }\r\n    }\r\n\r\n    .checkout-bar {\r\n      background: rgba(26, 26, 26, 0.9);\r\n\r\n      .total-label {\r\n        color: rgba(255, 255, 255, 0.6);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/HBuilder/Project/MyOrderTest/pages/cart/cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["store","uni","cartApi","orderApi"],"mappings":"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"}