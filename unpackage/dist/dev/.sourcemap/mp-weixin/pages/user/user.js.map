{"version":3,"file":"user.js","sources":["pages/user/user.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"user-container\">\r\n    <!-- 顶部背景 -->\r\n    <view class=\"header-bg\">\r\n      <uni-card class=\"user-card\">\r\n        <view class=\"user-info\">\r\n          <button \r\n            v-if=\"!isLoggedIn\" \r\n            class=\"avatar-box login-btn\" \r\n            @click=\"handleLogin\"\r\n            open-type=\"getUserInfo\"\r\n            @getuserinfo=\"onGetUserInfo\"\r\n          >\r\n            <uni-icons type=\"person\" size=\"50\" color=\"#999\"/>\r\n            <text class=\"login-tip\">点击登录</text>\r\n          </button>\r\n          <view class=\"avatar-box\" v-else>\r\n            <image :src=\"userInfo.avatarUrl\" mode=\"aspectFill\" class=\"avatar\"/>\r\n            <view class=\"user-text\">\r\n              <text class=\"nickname\">{{ userInfo.nickname }}</text>\r\n              <text class=\"user-id\">ID: {{ userInfo.id }}</text>\r\n            </view>\r\n          </view>\r\n          <uni-icons type=\"gear\" size=\"24\" color=\"#666\" @click=\"goToSettings\"/>\r\n        </view>\r\n      </uni-card>\r\n    </view>\r\n\r\n    <!-- 订单统计 -->\r\n    <uni-section title=\"我的订单\" type=\"line\">\r\n      <uni-grid :column=\"4\" :highlight=\"false\" :showBorder=\"false\">\r\n        <uni-grid-item v-for=\"(stat, index) in orderStats\" :key=\"index\" @click=\"goToOrders(stat.status)\">\r\n          <view class=\"stat-item\">\r\n            <text class=\"stat-num\">{{ stat.count }}</text>\r\n            <text class=\"stat-label\">{{ stat.label }}</text>\r\n          </view>\r\n        </uni-grid-item>\r\n      </uni-grid>\r\n    </uni-section>\r\n\r\n    <!-- 功能菜单 -->\r\n    <uni-section title=\"我的服务\" type=\"line\" class=\"menu-section\">\r\n      <view class=\"menu-grid\">\r\n        <view \r\n          class=\"menu-item\" \r\n          v-for=\"item in menuItems\" \r\n          :key=\"item.id\"\r\n          @tap=\"handleMenuClick(item)\"\r\n        >\r\n          <uni-icons \r\n            custom-prefix=\"custom-icon\"\r\n            :type=\"item.icon\" \r\n            size=\"28\" \r\n            :color=\"item.color\"\r\n          />\r\n          <text class=\"menu-name\">{{ item.name }}</text>\r\n          <uni-badge \r\n            v-if=\"item.badge\" \r\n            :text=\"item.badge\" \r\n            :type=\"item.badgeType || 'error'\" \r\n            absolute=\"rightTop\"\r\n          />\r\n        </view>\r\n      </view>\r\n    </uni-section>\r\n\r\n    <!-- 退出按钮弹窗 -->\r\n    <uni-popup ref=\"logoutPopupRef\" type=\"dialog\">\r\n      <uni-popup-dialog\r\n        type=\"warning\"\r\n        title=\"提示\"\r\n        content=\"确定要退出登录吗？\"\r\n        :duration=\"2000\"\r\n        :before-close=\"true\"\r\n        @confirm=\"confirmLogout\"\r\n        @close=\"closeLogout\"\r\n      />\r\n    </uni-popup>\r\n\r\n    <view class=\"bottom-area\" v-if=\"isLoggedIn\">\r\n      <button class=\"logout-btn\" @tap=\"handleLogout\">\r\n        <uni-icons type=\"poweroff\" size=\"16\" color=\"#ff5a5f\"/>\r\n        <text>退出登录</text>\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { userApi } from '@/api'\r\nimport store from '@/store'\r\n\r\nexport default {\r\n  setup() {\r\n    const isLoggedIn = ref(false)\r\n    const userInfo = reactive({\r\n      id: '',\r\n      openId: '',\r\n      nickname: '',\r\n      avatarUrl: '',\r\n      gender: 0\r\n    })\r\n    const orderStats = ref([\r\n      { label: '全部订单', count: 0, status: 'all' },\r\n      { label: '待付款', count: 0, status: 'pending' },\r\n      { label: '进行中', count: 0, status: 'processing' },\r\n      { label: '已完成', count: 0, status: 'completed' }\r\n    ])\r\n    const menuItems = ref([\r\n      { \r\n        id: 1, \r\n        name: '我的订单', \r\n        icon: 'list', \r\n        color: '#007AFF',\r\n        path: '/pages/order/list'\r\n      },\r\n      { \r\n        id: 2, \r\n        name: '优惠券', \r\n        icon: 'ticket', \r\n        color: '#51cf66',\r\n        badge: '2',\r\n        badgeType: 'error',\r\n        path: '/pages/coupon/list'\r\n      },\r\n      { \r\n        id: 3, \r\n        name: '联系客服',\r\n        icon: 'headphones', \r\n        color: '#fcc419',\r\n        path: '/pages/service/contact'\r\n      },\r\n      {\r\n        id: 4,\r\n        name: '设置',\r\n        icon: 'gear',\r\n        color: '#666',\r\n        path: '/pages/settings/index'\r\n      }\r\n    ])\r\n\r\n    // 添加 logoutPopup 的引用\r\n    const logoutPopupRef = ref(null)\r\n\r\n    // 获取用户信息回调\r\n    const onGetUserInfo = async (e) => {\r\n      try {\r\n        if (e.detail.errMsg !== 'getUserInfo:ok') {\r\n          throw new Error('用户拒绝授权')\r\n        }\r\n\r\n        // 获取登录code\r\n        const loginRes = await new Promise((resolve, reject) => {\r\n          uni.login({\r\n            provider: 'weixin',\r\n            success: res => resolve(res),\r\n            fail: err => reject(err)\r\n          })\r\n        })\r\n\r\n        // 调用后端登录接口\r\n        const res = await userApi.wxLogin({\r\n          code: loginRes.code,\r\n          userInfo: e.detail.userInfo\r\n        })\r\n\r\n        // 更新状态\r\n        Object.assign(userInfo, {\r\n          ...res.user,\r\n          nickName: e.detail.userInfo.nickName,\r\n          avatarUrl: e.detail.userInfo.avatarUrl,\r\n          gender: e.detail.userInfo.gender\r\n        })\r\n        \r\n        store.login(userInfo, res.token)\r\n        isLoggedIn.value = true\r\n\r\n        uni.showToast({\r\n          title: '登录成功',\r\n          icon: 'success'\r\n        })\r\n        console.log(res)\r\n        console.log(userInfo)\r\n      } catch (error) {\r\n        console.error('登录失败:', error)\r\n        if (error.message === '用户拒绝授权') {\r\n          uni.showModal({\r\n            title: '提示',\r\n            content: '需要您的授权才能继续使用',\r\n            showCancel: false\r\n          })\r\n        } else {\r\n          uni.showToast({\r\n            title: error.message || '登录失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    // 确认退出登录\r\n    const confirmLogout = () => {\r\n      store.logout()\r\n      isLoggedIn.value = false\r\n      uni.showToast({\r\n        title: '已退出登录',\r\n        icon: 'success'\r\n      })\r\n      logoutPopupRef.value.close()\r\n    }\r\n\r\n    // 关闭退出登录弹窗\r\n    const closeLogout = () => {\r\n      logoutPopupRef.value.close()\r\n    }\r\n\r\n    // 显示退出登录弹窗\r\n    const handleLogout = () => {\r\n      logoutPopupRef.value.open()\r\n    }\r\n\r\n    // 跳转设置页面\r\n    const goToSettings = () => {\r\n      uni.navigateTo({\r\n        url: '/pages/settings/index'\r\n      })\r\n    }\r\n\r\n    // 跳转订单列表\r\n    const goToOrders = (status) => {\r\n      if (!isLoggedIn.value) {\r\n        uni.showModal({\r\n          title: '提示',\r\n          content: '请先登录',\r\n          confirmText: '去登录',\r\n          success: (res) => {\r\n            if (res.confirm) {\r\n              handleLogin()\r\n            }\r\n          }\r\n        })\r\n        return\r\n      }\r\n      \r\n      uni.navigateTo({\r\n        url: `/pages/order/list?status=${status}`\r\n      })\r\n    }\r\n\r\n    // 处理菜单点击\r\n    const handleMenuClick = (item) => {\r\n      if (!isLoggedIn.value) {\r\n        uni.showModal({\r\n          title: '提示',\r\n          content: '请先登录',\r\n          confirmText: '去登录',\r\n          success: (res) => {\r\n            if (res.confirm) {\r\n              handleLogin()\r\n            }\r\n          }\r\n        })\r\n        return\r\n      }\r\n      \r\n      uni.navigateTo({\r\n        url: item.path\r\n      })\r\n    }\r\n\r\n    return {\r\n      isLoggedIn,\r\n      userInfo,\r\n      orderStats,\r\n      menuItems,\r\n      handleLogout,\r\n      goToSettings,\r\n      goToOrders,\r\n      handleMenuClick,\r\n      onGetUserInfo,\r\n      logoutPopupRef,\r\n      confirmLogout,\r\n      closeLogout\r\n    }\r\n  },\r\n  \r\n  onShow() {\r\n   \r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.user-container {\r\n  min-height: 100vh;\r\n  background: #f7f7f7;\r\n\r\n  .header-bg {\r\n    height: 200rpx;\r\n    background: linear-gradient(120deg, #007AFF, #00b4ff);\r\n    position: relative;\r\n    \r\n    .user-card {\r\n      position: absolute;\r\n      left: 30rpx;\r\n      right: 30rpx;\r\n      bottom: -60rpx;\r\n      background: #fff;\r\n      border-radius: 20rpx;\r\n      box-shadow: 0 4rpx 24rpx rgba(0,0,0,0.08);\r\n\r\n      :deep(.uni-card__content) {\r\n        padding: 0;\r\n      }\r\n\r\n      .user-info {\r\n        padding: 24rpx 30rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n\r\n        .avatar-box {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 20rpx;\r\n\r\n          .avatar {\r\n            width: 100rpx;\r\n            height: 100rpx;\r\n            border-radius: 50rpx;\r\n            background: #f5f5f5;\r\n          }\r\n\r\n          .user-text {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 6rpx;\r\n\r\n            .nickname {\r\n              font-size: 32rpx;\r\n              font-weight: 600;\r\n              color: #333;\r\n            }\r\n\r\n            .user-id {\r\n              font-size: 24rpx;\r\n              color: #999;\r\n            }\r\n          }\r\n\r\n          .login-tip {\r\n            font-size: 28rpx;\r\n            color: #666;\r\n            margin-left: 16rpx;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  :deep(.uni-section) {\r\n    margin-top: 80rpx;\r\n    background: #fff;\r\n\r\n    .uni-section-header {\r\n      padding: 20rpx 30rpx 16rpx;\r\n      \r\n      .uni-section-header__content {\r\n        .uni-section__content-title {\r\n          font-size: 30rpx;\r\n          font-weight: 600;\r\n          color: #333;\r\n        }\r\n      }\r\n    }\r\n\r\n    &.menu-section {\r\n      margin-top: 2rpx;\r\n      border-top: 1rpx solid #f0f0f0;\r\n    }\r\n\r\n    &:not(:last-child) {\r\n      position: relative;\r\n      &::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 30rpx;\r\n        right: 30rpx;\r\n        height: 1rpx;\r\n        background: #f0f0f0;\r\n      }\r\n    }\r\n  }\r\n\r\n  .stat-item {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    padding: 20rpx 0;\r\n    position: relative;\r\n\r\n    &::after {\r\n      content: '';\r\n      position: absolute;\r\n      right: 0;\r\n      top: 20%;\r\n      height: 60%;\r\n      width: 1rpx;\r\n      background: #f0f0f0;\r\n    }\r\n\r\n    &:last-child::after {\r\n      display: none;\r\n    }\r\n\r\n    .stat-num {\r\n      font-size: 36rpx;\r\n      font-weight: 600;\r\n      color: #333;\r\n      line-height: 1;\r\n    }\r\n\r\n    .stat-label {\r\n      font-size: 24rpx;\r\n      color: #999;\r\n      margin-top: 8rpx;\r\n    }\r\n  }\r\n\r\n  .menu-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(3, 1fr);\r\n    gap: 20rpx;\r\n    padding: 20rpx 30rpx 30rpx;\r\n\r\n    .menu-item {\r\n      position: relative;\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      gap: 12rpx;\r\n      padding: 24rpx 16rpx;\r\n      background: #f8f9fa;\r\n      border-radius: 16rpx;\r\n      transition: all 0.3s;\r\n\r\n      &:active {\r\n        transform: scale(0.95);\r\n        background: #f0f0f0;\r\n      }\r\n\r\n      .uni-icons {\r\n        background: rgba(0,0,0,0.04);\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border-radius: 50%;\r\n        margin-bottom: 6rpx;\r\n      }\r\n\r\n      .menu-name {\r\n        font-size: 26rpx;\r\n        color: #666;\r\n      }\r\n\r\n      :deep(.uni-badge) {\r\n        transform: translate(50%, -50%);\r\n      }\r\n    }\r\n  }\r\n\r\n  .bottom-area {\r\n    padding: 30rpx;\r\n\r\n    .logout-btn {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      gap: 10rpx;\r\n      height: 88rpx;\r\n      background: #fff;\r\n      border-radius: 44rpx;\r\n      color: #ff5a5f;\r\n      font-size: 28rpx;\r\n      border: none;\r\n      box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\r\n\r\n      &:active {\r\n        transform: scale(0.98);\r\n        background: #f8f8f8;\r\n      }\r\n    }\r\n  }\r\n\r\n  .login-btn {\r\n    background: none !important;\r\n    border: none !important;\r\n    padding: 0 !important;\r\n    margin: 0 !important;\r\n    line-height: normal !important;\r\n    color: inherit !important;\r\n    font-size: inherit !important;\r\n    font-weight: normal !important;\r\n    \r\n    &::after {\r\n      border: none !important;\r\n    }\r\n    \r\n    &.button-hover {\r\n      opacity: 0.8;\r\n      background: none !important;\r\n    }\r\n  }\r\n}\r\n</style> ","import MiniProgramPage from 'E:/HBuilder/Project/MyOrderTest/pages/user/user.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni","res","userApi","store"],"mappings":"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"}